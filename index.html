<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Bitemporal Document Insert/Update Demo</title>

    <style>
      body {
        background: AliceBlue;
        background-image: url("http://www.marklogic.com/wp-content/uploads/2015/05/on-demand-token.svg");
        background-size: 100px 100px;
        background-position: right top;
        background-repeat: no-repeat;
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 12px;
      }

      h1 {
        text-align: center;
        font-style: italic;
        font-size: 20px;
      }

      #instructions {
        position: absolute;
        left: 850px;
        top: 78px;
        font-style: italic;
        font-size: 13px;
        width: 25em;
        word-wrap: normal;
      }
      
      #sysTimeBoxes {
        width: 25em;
        word-wrap: normal;
        font-size: 13px;
      }

      #searchURL {
        position: absolute;
        left: 5px;
        top: 4px;
        font-size: 13px;
      }

      #editDocDiv{
        position: absolute;
        left:850px;
        top: 400px;
        width: 25em;
      }
      
      hideSysTimeBoxes {
        visibility: hidden;
      }

      .svg-chart .background {
        shape-rendering: crispEdges;
        stroke: #ccc;
        fill: #fdfdfd;
        stroke-width: 1px;
        z-index: 2;
      }
      .svg-chart .g { fill: #4682B4; }

      .tooltip-txt {
        margin: 0;
        font-family: Helvetica;
        font-size: 18px;
        line-height: 18px;
        font-weight: bold;
      }

      .axis-label {
        font-family: Helvetica;
        font-size: 17px;
        font-weight: bold;
      }

      .yaxis {
        font-size: 14px;
      }
      .svg-chart .xaxis .tick text {
        transform: rotate(-45deg);
        text-anchor: end !important;
        font-size: 15px;
      }

      #uriEntered {
        font-size: 16px;
        position: absolute;
        left: 5px;
        top: 20px;
        width: 25em;
        word-wrap: normal;
      }


    </style>
  </head>

  <body>
    <h1><u>MarkLogic Bitemporal Visualization Demo</u></h1>
    <a href="search" id="searchURL">Click to go to search page</a>
    <div id='instructions'>
      <p>Change the logical document display to the specified URI of a logical document.</p>
      <p>Don't forget to include the "dot extension" ie .json.</p>

      <b>Enter URI:</b><br>
      <input type="text" name="collection" value="">
      <input type="button" id="pick-doc" value="Submit">

      <p>Enter a document property to display in the graph or choose one from the drop down menu.</p>

      <b>Enter Document Property:</b><br>
      <input type="text" name="documentProperty" value="">
     
      <input type="button" id="change-prop" value="Submit">
      <br><br>
      
      <select id="select-prop">
        <option>Choose a property</option>
      </select>
    </div>

    <p id="uriEntered"></p>

    <br></br>

    <div id="tooltip" class="hidden">
      <p><span id="value"></span></p>
    </div>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="public/moment.js"></script>
    <script type="text/javascript" src="public/d3.js"></script>
    <script type="text/javascript" src="public/bitemp_graph.js"></script>
    <script type="text/javascript" src="public/bitemp_graph_helper.js"></script>
    <script type="text/javascript" src="public/input_text_load_data.js"></script>

    <div id="bar-chart-large"></div>

    <script type="text/javascript">
      //found from http://stackoverflow.com/questions/19491336/get-url-parameter-jquery
      $.urlParam = function(name) {
        var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
        if (results === null) {
           return null;
        }
        else {
           return results[1] || 0;
        }
      }

      var uri = $.urlParam('collection');
      if( uri !== null ) {
        loadData(uri);
        document.getElementById('uriEntered').innerHTML = "You are displaying documents in " + uri.bold();
      }
      else { //default
        loadData('addr.json');
      }
      
      $("input[name='insert']").click(function() {
        var col = $("input[name='tempcol']").val();
        var uri = $("input[name='uri']").val();
        var vs = $("input[name='validstart']").val();
        var ve = $("input[name='validend']").val();
        var sys = $("input[name='systemstart']").val();
        var d = $("input[name='content']").val();
        $.get(
          "/update?collection"+col+"&uri="+uri+
          "&validstart="+vs+"&validend="+ve+
          "&system="+sys+"&content="+d);
        });
    </script>

    <div id='editDocDiv'>
      <button id='editButton' > Edit </button>
      <button id='viewButton'> View </button>
      <button id='deleteButton'> Delete </button>
      <button id='saveButton' hidden="true"> Save </button>
      <button id='cancelButton' hidden='true'> Cancel </button>
      <textarea rows='12' cols='40' id='contents' hidden = 'true'> </textarea>
      <div id='sysTimeBoxes'>
        <p> <b> SysStart Time: </b> <input type='text' name='sysStartVal' value=''>
        <br> 
        <b> SysEnd Time: </b> <input type='text' name='sysEndVal' value=''> </p>
      </div>
    </div>
  </body>
</html>
